<!DOCTYPE html> <!-- Greg Daynes by Gregory Daynes URL: https://gregdaynes.com --> <html lang="en-GB"> <head> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Getting Started With Minitest | Greg Daynes</title> <meta name="generator" content="Jekyll v4.3.3" /> <meta property="og:title" content="Getting Started With Minitest" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Minitest is a comprehensive testing library that ships with Ruby. Take a deep look into what Minitest is, how to use it, some of it’s features and how it compares to RSpec." /> <meta property="og:description" content="Minitest is a comprehensive testing library that ships with Ruby. Take a deep look into what Minitest is, how to use it, some of it’s features and how it compares to RSpec." /> <link rel="canonical" href="https://gregdaynes.com/post/2018/09/08/getting-started-with-minitest.html" /> <meta property="og:url" content="https://gregdaynes.com/post/2018/09/08/getting-started-with-minitest.html" /> <meta property="og:site_name" content="Greg Daynes" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2018-09-08T00:00:00+00:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Getting Started With Minitest" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2018-09-08T00:00:00+00:00","datePublished":"2018-09-08T00:00:00+00:00","description":"Minitest is a comprehensive testing library that ships with Ruby. Take a deep look into what Minitest is, how to use it, some of it’s features and how it compares to RSpec.","headline":"Getting Started With Minitest","mainEntityOfPage":{"@type":"WebPage","@id":"https://gregdaynes.com/post/2018/09/08/getting-started-with-minitest.html"},"url":"https://gregdaynes.com/post/2018/09/08/getting-started-with-minitest.html"}</script> <!-- End Jekyll SEO tag --> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="page-datetime" content=""> <meta name="author" content="/humans.txt"> <meta name="keywords" content=""> <meta name="no-email-collection" content="/privacy.txt"> <meta name="description" content="The website and home of Gregory Daynes. Find links to projects, notebooks, and resume."> <meta name='HandheldFriendly' content='True'> <meta name='MobileOptimized' content='375'> <title>Getting Started With Minitest &bull; Greg Daynes</title> <style> :root{--ratio: 1.5;--s-5: calc(var(--s-4) / var(--ratio));--s-4: calc(var(--s-3) / var(--ratio));--s-3: calc(var(--s-2) / var(--ratio));--s-2: calc(var(--s-1) / var(--ratio));--s-1: calc(var(--s0) / var(--ratio));--s0: 1rem;--s1: calc(var(--s0) * var(--ratio));--s2: calc(var(--s1) * var(--ratio));--s3: calc(var(--s2) * var(--ratio));--s4: calc(var(--s3) * var(--ratio));--s5: calc(var(--s4) * var(--ratio));--_color-type-primary: black;--_color-type-secondary: silver;--_color-type-highlight: magenta;--_color-decoration-primary: black;--_color-decoration-shadow: black;--_color-background-primary: white;--_color-background-secondary: lightgray;--_color-link-normal: blue;--_color-link-hover: firebrick;--_color-link-active: cyan;--_color-link-visited: blue;--_color-link-current: firebrick;--_width-aside: 350px}@media(prefers-color-scheme: dark){:root{--_color-type-primary: white;--_color-background-primary: black;--_color-link-normal: dodgerblue;--_color-link-hover: magenta;--_color-link-active: cyan;--_color-link-visited: dodgerblue;--_color-link-current: magenta;--_color-decoration-primary: white;--_color-background-secondary: dimgray;--_color-decoration-shadow: dimgray}}/*! modern-normalize v2.0.0 | MIT License | https://github.com/sindresorhus/modern-normalize *//*! Font stacks by Chris Coyier | https://css-tricks.com/snippets/css/font-stacks/ */:root{font-size:100%;line-height:1.5;font-family:"Segoe UI",Candara,"Bitstream Vera Sans","DejaVu Sans","Bitstream Vera Sans","Trebuchet MS",Verdana,"Verdana Ref",sans-serif}@media(min-width: 768px){:root{font-size:clamp(1rem,1.125rem,4dvw)}}*{margin:0}*,::before,::after{box-sizing:border-box}:focus{outline-width:thin;outline-style:solid;outline-offset:var(--s-3)}html{font-weight:400;-webkit-text-size-adjust:100%;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body{background-color:var(--_color-background-primary);color:var(--_color-type-primary);max-width:1024px;margin-inline:auto;display:flex;flex-direction:column;min-height:100dvh;padding:var(--s1);gap:var(--s1)}hr{height:unset;color:inherit;border:none;background-color:var(--_color-background-secondary)}abbr[title]{text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,pre,samp{font-family:Consolas,"Andale Mono WT","Andale Mono","Lucida Console","Lucida Sans Typewriter","DejaVu Sans Mono","Bitstream Vera Sans Mono","Liberation Mono","Nimbus Mono L",Monaco,"Courier New",Courier,monospace;font-size:1rem}small{font-size:.8em}sub,sup{font-size:.75em;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-0.25em}sup{top:-0.5em}img{display:block;max-inline-size:100%}ol,ul{padding-inline-start:2ch}a{text-decoration:underline;text-underline-offset:.25rem;text-decoration-style:dotted;color:var(--_color-link-normal)}a:visited{color:var(--_color-link-visited)}a:hover{color:var(--_color-link-hover)}a:active{color:var(--_color-link-active)}a.current{color:var(--_color-link-current)}a:has(svg){display:inline-flex;align-items:center;gap:.5rem}a:has(svg) svg{opacity:.75}.main-wrapper{flex:1 1;display:flex;gap:var(--s1);flex-wrap:wrap;flex-direction:column;margin-inline:auto}@media(min-width: 768px){.main-wrapper{flex-direction:row}}main{flex-grow:1;flex-shrink:1;flex-basis:calc(66.6666666667% - var(--s1)/2)}aside{flex-grow:1;flex-shrink:1;flex-basis:calc(33.3333333333% - var(--s1)/2)}.banner{width:100%;display:inline-flex;gap:var(--s-2);line-height:1;text-transform:uppercase;font-size:1rem}.banner hr{flex:1;display:inline-block}.stack{display:flex;flex-direction:column;gap:var(--s1)}.stack .stack{gap:var(--s0)}.stack .stack .stack{gap:var(--s-2)}.more{font-weight:700;text-transform:uppercase;float:right}footer,header{line-height:1;display:flex}footer nav,header nav{display:flex;justify-content:center;flex-wrap:wrap;gap:var(--s-1)}header{font-family:Impact,Haettenschweiler,"Franklin Gothic Bold",Charcoal,"Helvetica Inserat","Bitstream Vera Sans Bold","Arial Black",sans-serif;flex-direction:column;text-transform:uppercase;text-align:center;gap:var(--s1)}header h1{font-size:clamp(1rem,10rem,16dvw);line-height:.9}header h2{font-size:clamp(1rem,2rem,8dvw)}header nav{font-size:clamp(1rem,1.375rem,4dvw)}header a{text-decoration:none;font-weight:700}header a.current{text-decoration:underline}footer{text-align:center;gap:var(--s-1);flex-wrap:wrap;justify-content:center}footer p{opacity:.5}.visually-hidden{clip:rect(0 0 0 0);clip-path:inset(100%);height:1px;overflow:hidden;position:absolute;width:1px;white-space:nowrap}.toc-list{width:100%;list-style-type:none;padding:0}.toc-list li>.row{text-decoration:none;display:grid;grid-template-columns:auto max-content;align-items:end}.toc-list li>.row>.page{text-align:right;font-family:monospace;padding-inline-start:.5ch}.toc-list li>.row>.title{position:relative;overflow:hidden}.toc-list li>.row .leaders::after{position:absolute;content:". . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . " ". . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . " ". . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . " ". . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . ";text-align:right}.toc-list li>.row:has(a:focus){outline-width:thin;outline-style:solid;outline-offset:var(--s-3);outline-color:currentColor}.toc-list li>.row:has(a:focus) a:focus{outline:none}.toc-list li{margin-block-end:var(--s-2)}.card{text-align:center;padding:var(--s-3);outline:1px solid;font-weight:700;text-decoration:none;line-height:1;font-size:1rem} </style> <style> #markdown-toc ul,#markdown-toc li{margin-block-end:0}article *+*{margin-block-start:var(--s-1)}article div:has(>pre),article figure:has(>pre){padding:var(--s1);box-shadow:inset 0 0 0 1px var(--_color-decoration-shadow);border-radius:4px;overflow:scroll;background:rgba(0,0,0,.0666666667);display:flex}article code{opacity:.75;white-space:wrap}article #markdown-toc ul{padding-inline-start:2ch} </style> <link rel="author" href="/humans.txt" /> <link rel="me" href="https://mastodon.social/@gregdaynes" /> <link rel="icon" type="image/png" href="/assets/images/favicon.png"> <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' stroke='currentColor' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' class='feather feather-smile' viewBox='0 0 24 24'%3E%3Ccircle cx='12' cy='12' r='10'/%3E%3Cpath d='M8 14s1.5 2 4 2 4-2 4-2M9 9h0m6 0h0'/%3E%3C/svg%3E%3Cstyle%3E@media (prefers-color-scheme:light)%7B:root%7Bfilter:contrast(1) brightness(1)%7D%7D@media (prefers-color-scheme:dark)%7B:root%7Bfilter:invert(100%25)%7D%7D%3C/style%3E%3C/svg%3E%0A" /> <link type="application/atom+xml" rel="alternate" href="https://gregdaynes.com/feed.xml" title="Greg Daynes" /> <link rel="shortcut icon" href="/assets/img/favicon-32x32.png" /> <body class="page getting-started-with-minitest"> <header> <hgroup> <h1><a href="/">Greg Daynes</a></h1> <h2>Full Stack Software Design, Development & Management</h2> </hgroup> <nav> <a href="/">Home</a> <a href="/about">About</a> <a href="/resume">Resume</a> <a href="/projects">Projects</a> <a href="/notebook">Notebook</a> </nav> </header> <div class="main-wrapper"> <main class="stack"> <article> <h2 class="banner">Getting Started With Minitest <hr></h2> <ul id="markdown-toc"> <li><a href="#what-is-minitest" id="markdown-toc-what-is-minitest">What is Minitest?</a></li> <li><a href="#how-to-start-testing-with-minitest" id="markdown-toc-how-to-start-testing-with-minitest">How to start testing with Minitest</a> <ul> <li><a href="#begin-by-creating-your-test-file" id="markdown-toc-begin-by-creating-your-test-file">Begin by creating your test file</a></li> <li><a href="#write-your-first-test" id="markdown-toc-write-your-first-test">Write your first test</a></li> <li><a href="#write-an-assertion" id="markdown-toc-write-an-assertion">Write an assertion</a></li> <li><a href="#running-your-first-test" id="markdown-toc-running-your-first-test">Running your first test</a></li> <li><a href="#fix-the-failing-test-case" id="markdown-toc-fix-the-failing-test-case">Fix the failing test case</a></li> <li><a href="#add-another-test-case" id="markdown-toc-add-another-test-case">Add another test case</a></li> </ul> </li> <li><a href="#how-to-write-tests-using-spec" id="markdown-toc-how-to-write-tests-using-spec">How to write tests using Spec</a> <ul> <li><a href="#write-your-first-spec" id="markdown-toc-write-your-first-spec">Write your first spec</a></li> <li><a href="#update-test-descriptions" id="markdown-toc-update-test-descriptions">Update test descriptions</a></li> <li><a href="#replace-test-methods-with-it-statements" id="markdown-toc-replace-test-methods-with-it-statements">Replace test methods with it statements</a></li> <li><a href="#replace-variable-definitions-with-let-statements" id="markdown-toc-replace-variable-definitions-with-let-statements">Replace variable definitions with <code class="language-plaintext highlighter-rouge">let</code> statements</a></li> <li><a href="#replace-class-calls-with-subject" id="markdown-toc-replace-class-calls-with-subject">Replace class calls with subject.</a></li> </ul> </li> <li><a href="#rake-task" id="markdown-toc-rake-task">Rake Task</a></li> <li><a href="#finish-the-test-suite" id="markdown-toc-finish-the-test-suite">Finish the test suite</a></li> <li><a href="#in-deeper-with-minitest" id="markdown-toc-in-deeper-with-minitest">In Deeper with Minitest</a> <ul> <li><a href="#built-in-assertions" id="markdown-toc-built-in-assertions">Built in assertions</a></li> <li><a href="#using-seeds-to-replay-tests" id="markdown-toc-using-seeds-to-replay-tests">Using Seeds to replay tests</a></li> <li><a href="#setting-up-and-tearing-down-tests" id="markdown-toc-setting-up-and-tearing-down-tests">Setting up and tearing down tests</a></li> <li><a href="#skipping-tests" id="markdown-toc-skipping-tests">Skipping tests</a></li> <li><a href="#stubbing" id="markdown-toc-stubbing">Stubbing</a></li> </ul> </li> <li><a href="#benchmarking-minitest" id="markdown-toc-benchmarking-minitest">Benchmarking Minitest</a></li> <li><a href="#minitest--rails" id="markdown-toc-minitest--rails">Minitest &amp; Rails</a></li> <li><a href="#references" id="markdown-toc-references">References</a></li> </ul> <h2 id="what-is-minitest">What is Minitest?</h2> <p>Minitest is a complete, lightweight suite of testing utilities for Ruby.</p> <p>It was created and is maintained by the Seattle Ruby community, and was accepted into Ruby core for 1.9.</p> <p>Minitest provides support for TDD, BDD, Mocks/Stubs, Benchmarking, can run Capybara specs, has a spec DSL, can be easily extended however you see fit (it’s Ruby after all).</p> <p>Here is a quick example of a test in Minitest</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">'minitest/autorun'</span>

<span class="k">class</span> <span class="nc">Coffee</span>
  <span class="nb">attr_reader</span> <span class="ss">:color</span>

  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="vi">@color</span> <span class="o">=</span> <span class="ss">:black</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">CoffeeTest</span> <span class="o">&lt;</span> <span class="no">Minitest</span><span class="o">::</span><span class="no">Test</span>
  <span class="k">def</span> <span class="nf">test_color</span>
    <span class="n">fresh_coffee</span> <span class="o">=</span> <span class="no">Coffee</span><span class="p">.</span><span class="nf">new</span>
    <span class="n">assert</span> <span class="n">cup_of_coffee</span><span class="p">.</span><span class="nf">color</span> <span class="o">==</span> <span class="ss">:black</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure> <h2 id="how-to-start-testing-with-minitest">How to start testing with Minitest</h2> <p>Getting started with Minitest is amazingly easy. If you can write Ruby (even if you’ve only written a few methods) you can write Minitest.</p> <h3 id="begin-by-creating-your-test-file">Begin by creating your test file</h3> <p>To get started, create a file called <code class="language-plaintext highlighter-rouge">coffee_test.rb</code></p> <p><em>It is recommended to follow the Minitest convention by ending the file name with _test.rb. This is not a hard requirement, but will make for a good habit when adding tests for Rails or other projects that have tooling around <code class="language-plaintext highlighter-rouge">_test</code>.</em></p> <p>Next, add <code class="language-plaintext highlighter-rouge">minitest/autorun</code> as a requirement Then create a new class <code class="language-plaintext highlighter-rouge">CoffeeTest</code> as a subclass of <code class="language-plaintext highlighter-rouge">Minitest::Test</code></p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># coffee_test.rb</span>

<span class="nb">require</span> <span class="s1">'minitest/autorun'</span>

<span class="k">class</span> <span class="nc">CoffeeTest</span> <span class="o">&lt;</span> <span class="no">Minitest</span><span class="o">::</span><span class="no">Test</span>
<span class="k">end</span></code></pre></figure> <p><em>You can add more gems, and utilities to add even more power to Minitest, but keep it simple to start.</em></p> <p>As your test suite grows, it’s a good idea to move all the <code class="language-plaintext highlighter-rouge">require</code>s and setup into common place like <code class="language-plaintext highlighter-rouge">test_helper.rb</code>. That way you keep your tests DRY</p> <h3 id="write-your-first-test">Write your first test</h3> <p>Now that the boilerplate ready, add the first test method.</p> <p><em>getting-started-with-minitest tests are just plain old Ruby methods.</em></p> <p>Start by adding a new method starting with <code class="language-plaintext highlighter-rouge">test_</code> to the class.</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># coffee_test.rb</span>

<span class="nb">require</span> <span class="s1">'minitest/autorun'</span>

<span class="k">class</span> <span class="nc">CoffeeTest</span> <span class="o">&lt;</span> <span class="no">Minitest</span><span class="o">::</span><span class="no">Test</span>
  <span class="k">def</span> <span class="nf">test_coffee</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure> <p>The <code class="language-plaintext highlighter-rouge">test_</code> prefix for the method is how Minitest distinguishes Ruby test methods and other methods in the test file, (like helper methods that handle setup, or create data for use across multiple tests).</p> <p>_<code class="language-plaintext highlighter-rouge">test_</code> is one way to write tests in Minitest. Another way is to use a Spec DSL, which is explained later in this post._</p> <h3 id="write-an-assertion">Write an assertion</h3> <p>An assertion will check to see if the returned value of a block or call evaluates to <code class="language-plaintext highlighter-rouge">true</code>. If so, the test will pass. If not false, the test fails.</p> <p>To test the opposite, blocks or calls returning false, use <code class="language-plaintext highlighter-rouge">refute</code>. The default Minitest <code class="language-plaintext highlighter-rouge">assert</code> methods have opposite <code class="language-plaintext highlighter-rouge">refute</code> methods that take the same params.</p> <p>Now write an assertion, in this case, we’re going to test that a new instance of <code class="language-plaintext highlighter-rouge">Coffee</code> is still a <code class="language-plaintext highlighter-rouge">Coffee</code>.</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># coffee_test.rb</span>

<span class="nb">require</span> <span class="s1">'minitest/autorun'</span>

<span class="k">class</span> <span class="nc">CoffeeTest</span> <span class="o">&lt;</span> <span class="no">Minitest</span><span class="o">::</span><span class="no">Test</span>
  <span class="k">def</span> <span class="nf">test_coffee</span>
    <span class="n">assert_instance_of</span> <span class="no">Coffee</span><span class="p">,</span> <span class="no">Coffee</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure> <p>This is done using the assertion <code class="language-plaintext highlighter-rouge">assert_instance_of</code>, which takes a <code class="language-plaintext highlighter-rouge">class</code>, and an <code class="language-plaintext highlighter-rouge">obj</code>, checking whether or not the <code class="language-plaintext highlighter-rouge">obj</code> is an instance of <code class="language-plaintext highlighter-rouge">class</code>.</p> <h3 id="running-your-first-test">Running your first test</h3> <p>Running a test file is the same as any Ruby script.</p> <p>Start up a Terminal in the same location as your test file, and run the following command.</p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>ruby coffee_test.rb</code></pre></figure> <p>The output should be similar to the following.</p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash">Run options: <span class="nt">--seed</span> 35012

<span class="c"># Running:</span>

E

Finished <span class="k">in </span>0.000729s, 1371.7422 runs/s, 0.0000 assertions/s.

1<span class="o">)</span> Error:
CoffeeTest#test_coffee:
NameError: uninitialized constant CoffeeTest::Coffee
Did you mean?  CoffeeTest
    test_001b.rb:5:in <span class="sb">`</span>test_coffee<span class="s1">'

1 runs, 0 assertions, 0 failures, 1 errors, 0 skips</span></code></pre></figure> <p>Great! Sort of, the test ran successfully, but the it failed.</p> <h3 id="fix-the-failing-test-case">Fix the failing test case</h3> <p>Looking over the output from the test run, notice the following:</p> <ul> <li><code class="language-plaintext highlighter-rouge">Run options: --seed 35012</code> This is the seed test was run with. It is randomized each time the test is run. More on seeds below.</li> <li>A series of <code class="language-plaintext highlighter-rouge">...</code>s and <code class="language-plaintext highlighter-rouge">F</code>s. These signify successes and exceptions. For now it is just a single <code class="language-plaintext highlighter-rouge">E</code></li> <li>How long the testing took, how many times it will run in per second, and how many assertions we can run per second. This is useful later in determining how fast your suite is. Fast tests = faster development</li> <li>List of errors, where they occurred and possible fix</li> <li>General stats about the run of tests just performed</li> </ul> <p>The test ran quickly, but failed. Look over the error. It indicates that <code class="language-plaintext highlighter-rouge">Coffee</code> is not defined anywhere. That’s an easy fix.</p> <p>Add the <code class="language-plaintext highlighter-rouge">Coffee</code> class.</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># coffee.rb</span>

<span class="k">class</span> <span class="nc">Coffee</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">;</span> <span class="k">end</span>
<span class="k">end</span>


<span class="c1"># coffee.rb</span>

<span class="nb">require</span> <span class="s1">'minitest/autorun'</span>
<span class="nb">require_relative</span> <span class="s1">'coffee'</span>

<span class="k">class</span> <span class="nc">CoffeeTest</span> <span class="o">&lt;</span> <span class="no">Minitest</span><span class="o">::</span><span class="no">Test</span>
  <span class="k">def</span> <span class="nf">test_coffee</span>
    <span class="n">assert_instance_of</span> <span class="no">Coffee</span><span class="p">,</span> <span class="no">Coffee</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure> <p>And now, run the test again. Same command as before</p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>ruby coffee_test.rb


Run options: <span class="nt">--seed</span> 5584

<span class="c"># Running:</span>

<span class="nb">.</span>

Finished <span class="k">in </span>0.000671s, 1490.3130 runs/s, 1490.3130 assertions/s.

1 runs, 1 assertions, 0 failures, 0 errors, 0 skips</code></pre></figure> <p>The test now passes.</p> <p>That’s all there is to testing using Minitest.</p> <h3 id="add-another-test-case">Add another test case</h3> <p>Add a test that will check an instance of Coffee, will return a list of flavours.</p> <p>The assertion to use here will be <code class="language-plaintext highlighter-rouge">assert_includes</code>. Which takes a <code class="language-plaintext highlighter-rouge">collection</code> and an <code class="language-plaintext highlighter-rouge">obj</code>, validating that the obj is in the collection.</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># coffee.rb</span>

<span class="k">class</span> <span class="nc">Coffee</span>
  <span class="nb">attr_reader</span> <span class="ss">:flavours</span>

  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="vi">@flavours</span> <span class="o">=</span> <span class="sx">%w[Chocolate Honey Toffee]</span>
  <span class="k">end</span>
<span class="k">end</span>


<span class="c1"># coffee_test.rb</span>

<span class="nb">require</span> <span class="s1">'minitest/autorun'</span>
<span class="nb">require_relative</span> <span class="s1">'coffee'</span>

<span class="k">class</span> <span class="nc">CoffeeTest</span> <span class="o">&lt;</span> <span class="no">Minitest</span><span class="o">::</span><span class="no">Test</span>
  <span class="k">def</span> <span class="nf">test_coffee</span>
    <span class="n">assert_instance_of</span> <span class="no">Coffee</span><span class="p">,</span> <span class="no">Coffee</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">test_coffee_flavour</span>
    <span class="n">possible_flavour</span> <span class="o">=</span> <span class="s1">'honey'</span>
    <span class="n">tasted_flavours</span> <span class="o">=</span> <span class="no">Coffee</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">flavours</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:downcase</span><span class="p">)</span>
    <span class="n">assert_includes</span> <span class="n">tasted_flavours</span><span class="p">,</span> <span class="n">possible_flavour</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure> <h2 id="how-to-write-tests-using-spec">How to write tests using Spec</h2> <p>Minitest comes with a Spec DSL. Which, instead of writing methods, they’re written plain english. If you’re familiar with RSpec, you’ll feel at home with Minitest/Spec.</p> <h3 id="write-your-first-spec">Write your first spec</h3> <p>Continuing with our previous coffee example, we’ll do the following:</p> <ul> <li>Update each test <code class="language-plaintext highlighter-rouge">test_description</code> to use <code class="language-plaintext highlighter-rouge">describe</code></li> <li>update each test to use <code class="language-plaintext highlighter-rouge">it</code>statements</li> <li>Make use of <code class="language-plaintext highlighter-rouge">let</code> statements</li> </ul> <h3 id="update-test-descriptions">Update test descriptions</h3> <p>We’ll start by moving our class <code class="language-plaintext highlighter-rouge">Coffee</code> above the tests.</p> <p><em>Make sure your test follows the class you’re resting. This wasn’t a requirement before because we were creating a new class. In this case, we’re referencing an existing class.</em></p> <p>Next, we’ll replace our class <code class="language-plaintext highlighter-rouge">CoffeeTest</code> with a describe block.</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># coffee.rb</span>

<span class="k">class</span> <span class="nc">Coffee</span>
  <span class="o">...</span>
<span class="k">end</span>


<span class="c1"># coffee_test.rb</span>

<span class="nb">require</span> <span class="s1">'minitest/autorun'</span>

<span class="n">describe</span> <span class="no">Coffee</span> <span class="k">do</span>
  <span class="o">...</span>
<span class="k">end</span></code></pre></figure> <p>The big change here is</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">CoffeeTest</span> <span class="o">&lt;</span> <span class="no">Minitest</span><span class="o">::</span><span class="no">Test</span></code></pre></figure> <p>becomes</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="n">describe</span> <span class="no">Coffee</span> <span class="k">do</span></code></pre></figure> <p>Everything else stays the same.</p> <p><em>You can nest describe blocks which can help with organizing larger test files into logical pieces.</em></p> <p>We’re now ready to continue upgrading our tests to specs.</p> <h3 id="replace-test-methods-with-it-statements">Replace test methods with it statements</h3> <p>Next, we’ll replace <code class="language-plaintext highlighter-rouge">test_</code> methods with <code class="language-plaintext highlighter-rouge">it</code> statements. This will make our tests read more like plain language, and less like a Ruby method.</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># coffee.rb</span>

<span class="k">class</span> <span class="nc">Coffee</span>
  <span class="o">...</span>
<span class="k">end</span>


<span class="c1"># coffee_test.rb</span>

<span class="nb">require</span> <span class="s1">'minitest/autorun'</span>

<span class="n">describe</span> <span class="no">Coffee</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s1">'gives us a new Coffee'</span> <span class="k">do</span>
    <span class="o">...</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'has a honey flavour'</span> <span class="k">do</span>
    <span class="o">...</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure> <p><code class="language-plaintext highlighter-rouge">it</code> statements define an expectation with a plain english name. If no name is passed in, it will default to anonymous. For readability, it’s recommended to add a name to all <code class="language-plaintext highlighter-rouge">it</code> statements.</p> <p><em>Under the hood, an <code class="language-plaintext highlighter-rouge">it</code> statement gets converted into a <code class="language-plaintext highlighter-rouge">test_the_thing</code> method like we had previously.</em></p> <h3 id="replace-variable-definitions-with-let-statements">Replace variable definitions with <code class="language-plaintext highlighter-rouge">let</code> statements</h3> <p><code class="language-plaintext highlighter-rouge">let</code> allows you to write a concise accessor that memoizes its contents after the first call to it.</p> <p><em>For our existing tests, we don’t have anything that needs it. We’re going to make our possible flavours more complicated than just a string so we can try using <code class="language-plaintext highlighter-rouge">let</code></em></p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># coffee.rb</span>

<span class="k">class</span> <span class="nc">Coffee</span>
  <span class="nb">attr_reader</span> <span class="ss">:flavours</span>

  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="vi">@flavours</span> <span class="o">=</span> <span class="sx">%w[Chocolate Honey Toffee]</span>
  <span class="k">end</span>
<span class="k">end</span>


<span class="c1"># coffee_test.rb</span>

<span class="nb">require</span> <span class="s1">'minitest/autorun'</span>
<span class="nb">require_relative</span> <span class="s1">'coffee'</span>

<span class="n">describe</span> <span class="no">Coffee</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s1">'gives us a new Coffee'</span> <span class="k">do</span>
    <span class="n">assert_instance_of</span> <span class="no">Coffee</span><span class="p">,</span> <span class="no">Coffee</span><span class="p">.</span><span class="nf">new</span>
  <span class="k">end</span>

  <span class="n">let</span><span class="p">(</span><span class="ss">:possible_flavour</span><span class="p">)</span> <span class="p">{</span> <span class="sx">%w[chocolate honey toffee]</span><span class="p">.</span><span class="nf">sample</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s1">'has a honey flavour'</span> <span class="k">do</span>
    <span class="n">tasted_flavours</span> <span class="o">=</span> <span class="no">Coffee</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">flavours</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:downcase</span><span class="p">)</span>
    <span class="n">assert_includes</span> <span class="n">tasted_flavours</span><span class="p">,</span> <span class="n">possible_flavour</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure> <p>You’ll notice that we defined the <code class="language-plaintext highlighter-rouge">let</code> statement outside of the <code class="language-plaintext highlighter-rouge">it</code> block. This is for reuse in other tests. And because it’s memoized, every other test that calls it will use the same value that was returned the first time it was called.</p> <p>Another common pattern is to put shared <code class="language-plaintext highlighter-rouge">let</code> statements at the top or at least above a series of tests that depend on them.</p> <p><strong>You can only access a <code class="language-plaintext highlighter-rouge">let</code> value from inside an <code class="language-plaintext highlighter-rouge">it</code> statement. If you try to access it from outside a <code class="language-plaintext highlighter-rouge">it</code> statement, the test suite will fail.</strong></p> <h3 id="replace-class-calls-with-subject">Replace class calls with subject.</h3> <p>Subject is a lazy man’s generator. It will return the block you specify as <code class="language-plaintext highlighter-rouge">subject</code>.</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># coffee.rb</span>

<span class="k">class</span> <span class="nc">Coffee</span>
  <span class="nb">attr_reader</span> <span class="ss">:flavours</span>

  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="vi">@flavours</span> <span class="o">=</span> <span class="sx">%w[Chocolate Honey Toffee]</span>
  <span class="k">end</span>
<span class="k">end</span>


<span class="c1"># coffee_test.rb</span>

<span class="nb">require</span> <span class="s1">'minitest/autorun'</span>
<span class="nb">require_relative</span> <span class="s1">'coffee'</span>

<span class="n">describe</span> <span class="no">Coffee</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:possible_flavour</span><span class="p">)</span> <span class="p">{</span> <span class="sx">%w[chocolate honey toffee]</span><span class="p">.</span><span class="nf">sample</span> <span class="p">}</span>

  <span class="n">subject</span> <span class="p">{</span> <span class="no">Coffee</span><span class="p">.</span><span class="nf">new</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s1">'gives us a new Coffee'</span> <span class="k">do</span>
    <span class="n">assert_instance_of</span> <span class="no">Coffee</span><span class="p">,</span> <span class="n">subject</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'has a honey flavour'</span> <span class="k">do</span>
    <span class="n">assert_includes</span> <span class="n">subject</span><span class="p">.</span><span class="nf">flavours</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:downcase</span><span class="p">),</span> <span class="n">possible_flavour</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure> <p>You’ll notice that we’ve placed <code class="language-plaintext highlighter-rouge">subject</code> above both of our test cases, it’s also not overly complex. But allows us to not write <code class="language-plaintext highlighter-rouge">Coffee.new</code> all over the place.</p> <h2 id="rake-task">Rake Task</h2> <p><em>Don’t know what rake is?</em> Rake is a task runner for Ruby. This post won’t show you how to use or write Rake Tasks, but how what a simple task looks like for testing. If you want to learn more about Rake, I recommend <a href="http://www.stuartellis.name/articles/rake/">Stuart Ellis’s - Using Rake to Automate Tasks</a>.</p> <p>Add Rake to your <code class="language-plaintext highlighter-rouge">Gemfile</code></p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash">gem <span class="nb">install </span>rake</code></pre></figure> <p>Add the following to <code class="language-plaintext highlighter-rouge">rakefile.rb</code>.</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># rakefile.rb</span>

<span class="nb">require</span> <span class="s1">'rake/testtask'</span>

<span class="n">desc</span> <span class="s1">'Run test suite'</span>
<span class="no">Rake</span><span class="o">::</span><span class="no">TestTask</span><span class="p">.</span><span class="nf">new</span><span class="p">()</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">pattern</span> <span class="o">=</span> <span class="s1">'./**/*_test.rb'</span>
<span class="k">end</span></code></pre></figure> <p>This will find all files ending with <code class="language-plaintext highlighter-rouge">_test.rb</code>, and then call each using <code class="language-plaintext highlighter-rouge">Rake::TestTask</code>.</p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash">rake <span class="nb">test</span></code></pre></figure> <p>Which will output results that looks exactly it you called the test directly. The difference is, the rake task groups all the tests to gether.</p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash">Run options: <span class="nt">--seed</span> 52969

<span class="c"># Running:</span>

..

Finished <span class="k">in </span>0.000582s, 3435.1925 runs/s, 5152.7888 assertions/s.

2 runs, 3 assertions, 0 failures, 0 errors, 0 skips</code></pre></figure> <h2 id="finish-the-test-suite">Finish the test suite</h2> <p>You should now have enough information to start implenting coverage on any of your Ruby programs.</p> <h2 id="in-deeper-with-minitest">In Deeper with Minitest</h2> <p>Now we’ll take a look into more of the features available in Minitest.</p> <h3 id="built-in-assertions">Built in assertions</h3> <p>Minitest comes with a ton of assertions built in, which will cover almost every test case you can think of. We’ll go over a few of the more common assertions below.</p> <p>Minitest assertions always check for a postive result. If you want to test for negative / false results, each assertion has a negative-twin <code class="language-plaintext highlighter-rouge">refute</code>. Which take the same params as their positive sibling, but make sure the result is the opposite.</p> <p><code class="language-plaintext highlighter-rouge">assert(predicate, msg = nil)</code> fails unless <code class="language-plaintext highlighter-rouge">predicate</code> returns true</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require_relative</span> <span class="s1">'test_helper'</span>

<span class="n">describe</span> <span class="no">Coffee</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">assert</span><span class="p">(</span><span class="no">Coffee</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">rating</span> <span class="o">==</span> <span class="s1">'Amazing!'</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span></code></pre></figure> <p><code class="language-plaintext highlighter-rouge">assert_empty(obj, msg = nil)</code> fails unless <code class="language-plaintext highlighter-rouge">obj</code> is empty</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require_relative</span> <span class="s1">'test_helper'</span>

<span class="n">describe</span> <span class="no">Coffee</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">assert_empty</span> <span class="no">Coffee</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">extras</span> <span class="p">}</span>
<span class="k">end</span></code></pre></figure> <p><code class="language-plaintext highlighter-rouge">assert_includes(collection, obj, msg = nil)</code> fails unless <code class="language-plaintext highlighter-rouge">collection</code> includes <code class="language-plaintext highlighter-rouge">obj</code></p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require_relative</span> <span class="s1">'test_helper'</span>

<span class="n">describe</span> <span class="no">Coffee</span> <span class="k">do</span>
  <span class="n">subject</span> <span class="p">{</span> <span class="no">Coffee</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">flavours</span> <span class="p">}</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">assert_includes</span> <span class="n">subject</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:downcase</span><span class="p">),</span> <span class="vg">$possible_flavour</span> <span class="p">}</span>
<span class="k">end</span></code></pre></figure> <p><code class="language-plaintext highlighter-rouge">assert_match(matcher, obj, message = nil)</code> fails unless <code class="language-plaintext highlighter-rouge">matcher</code> =~ <code class="language-plaintext highlighter-rouge">obj</code></p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require_relative</span> <span class="s1">'test_helper'</span>

<span class="n">describe</span> <span class="no">Coffee</span> <span class="k">do</span>
  <span class="n">matcher</span> <span class="o">=</span> <span class="sr">/[a-zA-Z].+\!/</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">assert_match</span> <span class="n">matcher</span><span class="p">,</span> <span class="no">Coffee</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">rating</span> <span class="p">}</span>
<span class="k">end</span></code></pre></figure> <p><code class="language-plaintext highlighter-rouge">assert_nil(obj, msg = nil)</code> fails unless <code class="language-plaintext highlighter-rouge">obj</code> is <code class="language-plaintext highlighter-rouge">nil</code></p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require_relative</span> <span class="s1">'test_helper'</span>

<span class="n">describe</span> <span class="no">Cup</span> <span class="k">do</span>
  <span class="n">it</span> <span class="p">{</span> <span class="n">assert_nil</span> <span class="no">Cup</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">filling</span> <span class="p">}</span>
<span class="k">end</span></code></pre></figure> <p><code class="language-plaintext highlighter-rouge">assert_raise(*exp)</code> fails unless the block raises an exception</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require_relative</span> <span class="s1">'test_helper'</span>

<span class="n">describe</span> <span class="s1">'Cup'</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:coffee</span><span class="p">)</span> <span class="p">{</span> <span class="no">Coffee</span><span class="p">.</span><span class="nf">new</span> <span class="p">}</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:cup</span><span class="p">)</span> <span class="p">{</span> <span class="no">Cup</span><span class="p">.</span><span class="nf">new</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s1">'raises when we add another cup'</span> <span class="k">do</span>
    <span class="n">assert_raises</span> <span class="no">RuntimeError</span> <span class="k">do</span>
      <span class="n">cup</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="no">Cup</span><span class="p">.</span><span class="nf">new</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure> <p>Minitest comes with a wide range of assertions for testing. You can see all of the available assertions and refutions in the <a href="http://ruby-doc.org/stdlib-2.0.0/libdoc/minitest/rdoc/MiniTest/Assertions.html">Ruby Docs - Assertions</a></p> <h3 id="using-seeds-to-replay-tests">Using Seeds to replay tests</h3> <p>If you’ve watched the output as you’ve run throug Minispec, you’ll probably have noticed the following</p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash">Run options: <span class="nt">--seed</span> 59802</code></pre></figure> <p>A seed is a representation of the order of tests, as well as the randomized data inside your tests. Keeping track of seeds allows you, or someone else to rerun the test exactly as a previous time. This helps for debugging failures.</p> <p>To specify seeds you need to pass in the value when running your test suite.</p> <p>If you run tests using the Ruby CLI</p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash">ruby <span class="nb">test</span> <span class="nt">-s</span> 59802</code></pre></figure> <p>If you run tests using a Rake Task</p> <figure class="highlight"><pre><code class="language-bash" data-lang="bash">rake <span class="nb">test </span><span class="nv">SEED</span><span class="o">=</span>59802</code></pre></figure> <h3 id="setting-up-and-tearing-down-tests">Setting up and tearing down tests</h3> <p>As you start building out tests for your code. You’ll notice patterns of setup, start happening around your tests.</p> <p>Minitest has you covered for wrapping each test with setup code, using <code class="language-plaintext highlighter-rouge">setup</code> and <code class="language-plaintext highlighter-rouge">teardown</code></p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require_relative</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">CoffeeTest</span> <span class="o">&lt;</span> <span class="no">Minitest</span><span class="o">::</span><span class="no">Test</span>
  <span class="k">def</span> <span class="nf">setup</span>
    <span class="vi">@cup</span> <span class="o">=</span> <span class="no">Cup</span><span class="p">.</span><span class="nf">new</span>
    <span class="vi">@cup</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="no">Coffee</span><span class="p">.</span><span class="nf">new</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">teardown</span>
    <span class="vi">@cup</span><span class="p">.</span><span class="nf">drink</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">test_cup_is_not_empty</span>
    <span class="n">refute</span> <span class="vi">@cup</span><span class="p">.</span><span class="nf">empty?</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure> <p>If you’re using specs, you can also use <code class="language-plaintext highlighter-rouge">before</code> and <code class="language-plaintext highlighter-rouge">after</code></p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require_relative</span> <span class="s1">'test_helper'</span>

<span class="n">describe</span> <span class="s1">'Coffee'</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:cup</span><span class="p">)</span> <span class="p">{</span> <span class="no">Cup</span><span class="p">.</span><span class="nf">new</span> <span class="p">}</span>

  <span class="n">before</span> <span class="k">do</span>
    <span class="n">cup</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="no">Coffee</span><span class="p">.</span><span class="nf">new</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">after</span> <span class="p">{</span> <span class="n">cup</span><span class="p">.</span><span class="nf">drink</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s1">'checks the cup has coffee in it'</span> <span class="k">do</span>
    <span class="n">refute</span> <span class="n">cup</span><span class="p">.</span><span class="nf">empty?</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure> <p><em><code class="language-plaintext highlighter-rouge">setup</code>, <code class="language-plaintext highlighter-rouge">teardown</code>, <code class="language-plaintext highlighter-rouge">before</code>, and <code class="language-plaintext highlighter-rouge">after</code> will be run around <strong>each</strong> test. This can add significant delays to your tests if you’re putting complex setup logic in the setup code. You can add the gem <code class="language-plaintext highlighter-rouge">minitest-hooks</code> to get access to <code class="language-plaintext highlighter-rouge">before_all</code>, <code class="language-plaintext highlighter-rouge">after_all</code> which runs around all tests in the test file. This is more commonly used when testing many parts of an instance that has a decent amount of setup</em></p> <h3 id="skipping-tests">Skipping tests</h3> <p>There comes a time when you are testing your code, and you realize you need to test something else as well. You can remember what you want to write, you can leave yourself a comment, or you can write a <code class="language-plaintext highlighter-rouge">skip</code> statement.</p> <p>Using <code class="language-plaintext highlighter-rouge">skip</code> is the same as using any of the <code class="language-plaintext highlighter-rouge">assert</code>, <code class="language-plaintext highlighter-rouge">refute</code> methods.</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require_relative</span> <span class="s1">'test_helper'</span>

<span class="n">describe</span> <span class="s1">'Coffee'</span> <span class="k">do</span>
  <span class="n">it</span> <span class="s1">'checks the coffee rating'</span> <span class="k">do</span>
    <span class="n">assert</span><span class="p">(</span><span class="no">Coffee</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">rating</span> <span class="o">==</span> <span class="s1">'Amazing!'</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">it</span> <span class="s1">'makes sure the taste is not bitter'</span> <span class="k">do</span>
    <span class="n">skip</span> <span class="s1">'coffee.taste should not be bitter'</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure> <p>Skip statements have an advantage over leaving a comment. That is the test reporter will show a list of all the skipped tests, so if you forget one, there is a small indicator to let you know you still have some work to do.</p> <p><em>But beware if you use setup/teardown, or before/after to do complex setups, these will still be run around the skipped test. This can increase your test time.</em></p> <h3 id="stubbing">Stubbing</h3> <p>Like other testing libraries, <code class="language-plaintext highlighter-rouge">stub</code>s temporarily replace a method and return the specified result. The original method is then swapped back in when the stub block is finished.</p> <p>Stubs are great for temporarily replacing methods that may take too long to run in your test suite, or are incapable of running in the environment. <strong>This does not mean that method should never be tested</strong>. Just that the method might be better tested elsewhere.</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Cup</span>
  <span class="o">...</span>
  <span class="k">def</span> <span class="nf">slow_drink</span>
    <span class="nb">sleep</span> <span class="mi">10</span>
    <span class="nb">puts</span> <span class="s1">'*slurp*'</span>
    <span class="nb">sleep</span> <span class="mi">10</span>
    <span class="nb">puts</span> <span class="s1">'*slurp*'</span>
    <span class="nb">sleep</span> <span class="mi">10</span>
    <span class="vi">@filling</span> <span class="o">=</span> <span class="kp">nil</span>
  <span class="k">end</span>
  <span class="o">...</span>
<span class="k">end</span></code></pre></figure> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="nb">require_relative</span> <span class="s1">'test_helper'</span>

<span class="n">describe</span> <span class="s1">'Cup'</span> <span class="k">do</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:coffee</span><span class="p">)</span> <span class="p">{</span> <span class="no">Coffee</span><span class="p">.</span><span class="nf">new</span> <span class="p">}</span>
  <span class="n">let</span><span class="p">(</span><span class="ss">:cup</span><span class="p">)</span> <span class="p">{</span> <span class="no">Cup</span><span class="p">.</span><span class="nf">new</span> <span class="p">}</span>

  <span class="n">before</span> <span class="p">{</span> <span class="n">cup</span><span class="p">.</span><span class="nf">add</span> <span class="n">coffee</span> <span class="p">}</span>

  <span class="n">it</span> <span class="s1">'drinks a coffee slowly'</span> <span class="k">do</span>
    <span class="n">cup</span><span class="p">.</span><span class="nf">stub</span> <span class="ss">:slow_drink</span><span class="p">,</span> <span class="n">cup</span><span class="p">.</span><span class="nf">filling</span> <span class="o">=</span> <span class="kp">nil</span> <span class="k">do</span>
      <span class="n">cup</span><span class="p">.</span><span class="nf">slow_drink</span>
      <span class="n">assert_nil</span> <span class="n">cup</span><span class="p">.</span><span class="nf">filling</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure> <p>Unlike a <code class="language-plaintext highlighter-rouge">Mock</code> the method needs to exist prior to stubbing. You can’t use a stub on a method that does not exist.</p> <p><em>If you must test a method that doesn’t exist, you can use a singleton method to create a new non-existant method</em></p> <h2 id="benchmarking-minitest">Benchmarking Minitest</h2> <p>Minitest comes with benchmarking baked in. This is handy for testing out performance for the code you write.</p> <p>There are 2 posts from Chris Kottom that describe Benchmarking with Minitest from a high level, as well as practical examples. I recommend reading them a few times.</p> <p><a href="https://chriskottom.com/blog/2015/04/minitest-benchmark-an-introduction">Minitest::Benchmark: An Introduction</a></p> <p><a href="https://chriskottom.com/blog/2015/05/minitest-benchmark-a-practical-example">Minitest::Benchmark: A Practical Example</a></p> <h2 id="minitest--rails">Minitest &amp; Rails</h2> <p>Rails by default uses Minitest to run your tests. In fact, Rails itself is tested using minitest.</p> <p>The default Rails <code class="language-plaintext highlighter-rouge">test_helper.rb</code> is configured to run <code class="language-plaintext highlighter-rouge">test</code> style tests, it looks like the following.</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># test_helper.rb</span>

<span class="no">ENV</span><span class="p">[</span><span class="s2">"RAILS_ENV"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"test"</span>
<span class="nb">require</span> <span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="s1">'../../config/environment'</span><span class="p">,</span> <span class="kp">__FILE__</span><span class="p">)</span>
<span class="nb">require</span> <span class="s1">'rails/test_help'</span>

<span class="k">class</span> <span class="nc">ActiveSupport::TestCase</span>
  <span class="c1"># Setup all fixtures in test/fixtures/*.(yml|csv) for all tests in alphabetical order.</span>
  <span class="c1">#</span>
  <span class="c1"># Note: You'll currently still have to declare fixtures explicitly in integration tests</span>
  <span class="c1"># -- they do not yet inherit this setting</span>
  <span class="n">fixtures</span> <span class="ss">:all</span>

  <span class="c1"># Add more helper methods to be used by all tests here...</span>
<span class="k">end</span></code></pre></figure> <p>We can add support for Minitest::Spec DSL pretty easily.</p> <figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1"># test_helper.rb</span>

<span class="no">ENV</span><span class="p">[</span><span class="s2">"RAILS_ENV"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"test"</span>
<span class="nb">require</span> <span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="s1">'../../config/environment'</span><span class="p">,</span> <span class="kp">__FILE__</span><span class="p">)</span>
<span class="nb">require</span> <span class="s1">'rails/test_help'</span>
<span class="nb">require</span> <span class="s1">'minitest/autorub'</span>

<span class="k">class</span> <span class="nc">ActiveSupport::TestCase</span>
  <span class="c1"># Setup all fixtures in test/fixtures/*.(yml|csv) for all tests in alphabetical order.</span>
  <span class="c1">#</span>
  <span class="c1"># Note: You'll currently still have to declare fixtures explicitly in integration tests</span>
  <span class="c1"># -- they do not yet inherit this setting</span>
  <span class="n">fixtures</span> <span class="ss">:all</span>

  <span class="c1"># Add more helper methods to be used by all tests here...</span>
  <span class="kp">extend</span> <span class="no">MiniTest</span><span class="o">::</span><span class="no">Spec</span><span class="o">::</span><span class="no">DSL</span>

  <span class="n">register_spec_type</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">desc</span><span class="o">|</span>
    <span class="n">desc</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span> <span class="k">if</span> <span class="n">desc</span><span class="p">.</span><span class="nf">is_a?</span><span class="p">(</span><span class="no">Class</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></figure> <p>With spec support inside <code class="language-plaintext highlighter-rouge">test_helper.rb</code> you can now write test, specs, and any combination of features to test your Rails code. <em>MAGIC</em></p> <h2 id="references">References</h2> <p>This post only covers a small portion of what Minitest can do. That is not including what the numerous extensions bring to the table.</p> <p>The following links should help you on your way to mastering Minitest.</p> <ul> <li><a href="https://github.com/seattlerb/minitest">SeattleRB - Minitest</a></li> <li><a href="http://ruby-doc.org/stdlib-2.0.0/libdoc/minitest/rdoc/MiniTest.html">Ruby Docs - Minitest</a></li> </ul> </article> </main> <aside class="stack"> <section class="stack"> <h2 class="banner">Projects <hr></h2> <div class="stack"> <a class="card" href="/project/2023/12/04/hyde-page-css-js.html">Hyde Page CSS & JS</a> <a class="card" href="/project/2023/11/11/turing-pi.html">Turing Pi</a> <a class="card" href="/project/2023/12/28/fellow-stagg-repair.html">Fellow Stagg Repair</a> <a class="card" href="/project/2023/12/22/hyde-decap.html">Hyde Decap</a> </div> <span><a class="more" href="/projects">More Projects</a></span> </section> <section class="stack"> <h2 class="banner">Notes <hr></h2> <ol class="toc-list"> <li> <span class="row"> <span class="title"> <a href="/note/2023/12/08/fixing-homebrew-permissions.html">Fixing Hombrew permissions when using ASDF</a> </span> </span> </li> <li> <span class="row"> <span class="title"> <a href="/note/2021/09/18/node-binary-artifacts.html">Node CLI / Binary Artifacts</a> </span> </span> </li> </ol> <span><a class="more" href="/notebook">More Notes</a></span> </section> </aside> </div> <footer> <div>©2024 Gregory Daynes</div> <nav> <a href="mailto:email@gregdaynes.com">Contact</a> <a href="/privacy.txt">Privacy</a> <a href="/humans.txt">Humans</a> <a href="/robots.txt">Robots</a> <a href="/sitemap.xml">Site Map</a> <a href="/feed.xml">RSS</a> </nav> <p><small>Content on this site is licensed under Creative Common Attribution-ShareAlike 4.0 International License. All code content is licensed under the MIT license, unless an excerpt from a larger work under another license.</small></p> </footer> <script> /** * fitty v2.4.2 - Snugly resizes text to fit its parent container * Copyright (c) 2023 Rik Schennink <rik@pqina.nl> (https://pqina.nl/) */ !function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).fitty=t()}(this,(function(){"use strict";return function(e){function t(e,t){var n=Object.assign({},E,t),i=e.map((function(e){var t=Object.assign({},n,{element:e,active:!0});return function(e){e.originalStyle={whiteSpace:e.element.style.whiteSpace,display:e.element.style.display,fontSize:e.element.style.fontSize},W(e),e.newbie=!0,e.dirty=!0,a.push(e)}(t),{element:e,fit:w(t,u),unfreeze:g(t),freeze:F(t),unsubscribe:z(t)}}));return f(),i}function n(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e?t(i(document.querySelectorAll(e)),n):t([e],n)[0]}if(e){var i=function(e){return[].slice.call(e)},r=0,o=1,l=2,u=3,a=[],c=null,f="requestAnimationFrame"in e?function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{sync:!1};e.cancelAnimationFrame(c);var n=function(){return d(a.filter((function(e){return e.dirty&&e.active})))};if(t.sync)return n();c=e.requestAnimationFrame(n)}:function(){},s=function(e){return function(t){a.forEach((function(t){return t.dirty=e})),f(t)}},d=function(e){e.filter((function(e){return!e.styleComputed})).forEach((function(e){e.styleComputed=v(e)})),e.filter(h).forEach(S);var t=e.filter(m);t.forEach(y),t.forEach((function(e){S(e),p(e)})),t.forEach(b)},p=function(e){return e.dirty=r},y=function(e){e.availableWidth=e.element.parentNode.clientWidth,e.currentWidth=e.element.scrollWidth,e.previousFontSize=e.currentFontSize,e.currentFontSize=Math.min(Math.max(e.minSize,e.availableWidth/e.currentWidth*e.previousFontSize),e.maxSize),e.whiteSpace=e.multiLine&&e.currentFontSize===e.minSize?"normal":"nowrap"},m=function(e){return e.dirty!==l||e.dirty===l&&e.element.parentNode.clientWidth!==e.availableWidth},v=function(t){var n=e.getComputedStyle(t.element,null);return t.currentFontSize=parseFloat(n.getPropertyValue("font-size")),t.display=n.getPropertyValue("display"),t.whiteSpace=n.getPropertyValue("white-space"),!0},h=function(e){var t=!1;return!e.preStyleTestCompleted&&(/inline-/.test(e.display)||(t=!0,e.display="inline-block"),"nowrap"!==e.whiteSpace&&(t=!0,e.whiteSpace="nowrap"),e.preStyleTestCompleted=!0,t)},S=function(e){e.element.style.whiteSpace=e.whiteSpace,e.element.style.display=e.display,e.element.style.fontSize=e.currentFontSize+"px"},b=function(e){e.element.dispatchEvent(new CustomEvent("fit",{detail:{oldValue:e.previousFontSize,newValue:e.currentFontSize,scaleFactor:e.currentFontSize/e.previousFontSize}}))},w=function(e,t){return function(n){e.dirty=t,e.active&&f(n)}},z=function(e){return function(){a=a.filter((function(t){return t.element!==e.element})),e.observeMutations&&e.observer.disconnect(),e.element.style.whiteSpace=e.originalStyle.whiteSpace,e.element.style.display=e.originalStyle.display,e.element.style.fontSize=e.originalStyle.fontSize}},g=function(e){return function(){e.active||(e.active=!0,f())}},F=function(e){return function(){return e.active=!1}},W=function(e){e.observeMutations&&(e.observer=new MutationObserver(w(e,o)),e.observer.observe(e.element,e.observeMutations))},E={minSize:16,maxSize:512,multiLine:!0,observeMutations:"MutationObserver"in e&&{subtree:!0,childList:!0,characterData:!0}},M=null,x=function(){e.clearTimeout(M),M=e.setTimeout(s(l),n.observeWindowDelay)},C=["resize","orientationchange"];return Object.defineProperty(n,"observeWindow",{set:function(t){var n="".concat(t?"add":"remove","EventListener");C.forEach((function(t){e[n](t,x)}))}}),n.observeWindow=!0,n.observeWindowDelay=100,n.fitAll=s(u),n}}("undefined"==typeof window?null:window)})),fitty("header h1"),fitty("header h2",{minSize:12}); </script> </body> </html>
