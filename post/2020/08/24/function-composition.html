<!DOCTYPE html><html lang=en-GB><head><meta name=viewport content="width=device-width, initial-scale=1"><meta name=keywords content=""><meta name=no-email-collection content="/privacy.txt"><meta name=twitter:card content=summary_large_image><meta property=og:title content="Function Composition • Greg Daynes"><meta property="og:description" name=description content="The website and home of Gregory Daynes. Find links to projects, notebooks, and resume."><meta property="og:image" content="data:;base64,iVBORw0KGgo="><title>Function Composition • Greg Daynes</title><link rel=me href="//mastodon.social/@gregdaynes"><link rel=author href="/humans.txt"><link rel=icon href="data:;base64,iVBORw0KGgo="><link type="application/atom+xml" rel=alternate href="/feed.xml"><style>:root{--ratio: 1.5;--s-3: calc(var(--s-2) / var(--ratio));--s-2: calc(var(--s-1) / var(--ratio));--s-1: calc(var(--s0) / var(--ratio));--s0: 1rem;--s1: calc(var(--s0) * var(--ratio));--_color-type-primary: black;--_color-type-secondary: silver;--_color-type-highlight: magenta;--_color-background-primary: white;--_color-background-secondary: lightgray;--_color-background-code: ghostwhite;--_color-link-normal: blue;--_color-link-hover: firebrick;--_color-link-active: cyan;--_color-link-visited: blue;--_color-link-current: firebrick}@media(prefers-color-scheme: dark){:root{--_color-type-primary: floralwhite;--_color-background-primary: #111;--_color-link-normal: darkorange;--_color-link-hover: gold;--_color-link-active: gold;--_color-link-visited: darkorange;--_color-link-current: orangered;--_color-background-code: color-mix(in srgb, slategray 30%, black)}}:root{line-height:1.5;font-family:sans-serif;font-size:clamp(1.1rem,1.5vw,1.3rem)}:is(*,*:visited):focus{--bg: var(--_color-link-normal);outline:none;box-shadow:0 0 0 .25rem var(--bg);background:var(--bg);color:var(--_color-background-primary)}html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;-moz-text-size-adjust:none;-webkit-text-size-adjust:none;text-size-adjust:none}body{background-color:var(--_color-background-primary);color:var(--_color-type-primary);max-width:1024px;margin-inline:auto;display:flex;flex-direction:column;min-height:100dvh;padding-inline:var(--s0)}a{color:var(--_color-link-normal);text-underline-offset:.1em;text-decoration-thickness:.05em}a:visited{color:var(--_color-link-visited)}a:hover{color:var(--_color-link-hover)}a:active{color:var(--_color-link-active)}a.current{color:var(--_color-link-current)}a:has(svg){display:inline-flex;align-items:center;gap:var(--s-1)}h2{margin-block-end:var(--s-3)}main :first-child{margin-block-start:0}@media screen and (min-width: 768px){aside :first-child{margin-block-start:0}}@media screen and (min-width: 768px){.with-sidebar{display:flex;flex-wrap:wrap;gap:var(--s1)}.with-sidebar>aside{flex-basis:30%;flex-grow:1}.with-sidebar>main{flex-basis:0;flex-grow:999;min-inline-size:50%}}:is(header,footer) li{display:inline}:is(header,footer) li+li::before{content:" "}header{font-family:impact;text-transform:uppercase;text-align:center;text-wrap:balance;line-height:1}header *{margin:0}header a{text-decoration:none}header nav{font-size:var(--s1);margin-block:var(--s1)}header .current{text-decoration:underline}footer{margin-block-start:auto;text-align:center;text-wrap:balance}.text-fit{--captured-length: initial;--support-sentinel: var(--captured-length, 9999px);display:flex;container-type:inline-size;text-wrap:initial}.text-fit>[aria-hidden]{visibility:hidden}.text-fit>:not([aria-hidden]){--captured-length: 100cqi;--available-space: var(--captured-length);flex-grow:1;container-type:inline-size}.text-fit>:not([aria-hidden])>*{--support-sentinel: inherit;--captured-length: 100cqi;--ratio: tan(atan2( var(--available-space), var(--available-space) - var(--captured-length) ));--font-size: clamp( 1em, 1em * var(--ratio), var(--max-font-size, infinity * 1px) - var(--support-sentinel) );inline-size:var(--available-space)}.text-fit>:not([aria-hidden])>*:not(.text-fit){display:block;font-size:var(--font-size)}@container (inline-size > 0){.text-fit>:not([aria-hidden])>*:not(.text-fit){white-space:nowrap}}.text-fit>:not([aria-hidden])>*.text-fit{--captured-length2: var(--font-size);font-variation-settings:"opsz" tan(atan2(var(--captured-length2),1px))}@property --captured-length{syntax:"<length>";initial-value:0px;inherits:true}@property --captured-length2{syntax:"<length>";initial-value:0px;inherits:true}nav:has(ol,ul) ol,nav:has(ol,ul) ul{list-style:none;padding:0}nav:has(ol,ul) div{display:flex;align-items:baseline;gap:var(--s-2);line-height:1.5}nav:has(ol,ul) .leaders{flex-grow:1;border-bottom:2px dotted}nav:has(ol,ul) time{flex-shrink:0}nav:has(ol,ul) p{margin-block:0 var(--s-2)}</style><style>code{font-size:.9em}p>code{background:var(--_color-background-code)}div.highlight{overflow:scroll;background:var(--_color-background-code)}pre{margin-block:0;padding:var(--s-1);border-radius:3px}</style></head><body class="page function-composition"><header><h1 class=text-fit><span><a href="/">Greg Daynes</a></span><span aria-hidden=true style="visibility: hidden">Greg Daynes</span></h1><p class=text-fit><span><span>Full Stack Software Design, Development & Management</span></span><span aria-hidden=true style="visibility: hidden">Full Stack Software Design, Development & Management</span></p><nav><ul><li><a href="/">Home</a></li><li><a href="/about">About</a></li><li><a href="/resume">Resume</a></li><li><a href="/projects">Projects</a></li><li><a href="/notebook">Notebook</a></li></ul></nav></header><div class=with-sidebar><main><article><h2>Function Composition</h2><p>This is a quick look at applying one of the core concepts in functional programming - Composition.</p><p>Starting with a simple function that takes a number as value and adds 2.</p><div class="language-js highlighter-rouge"><div class=highlight><pre class=highlight><code><span class="kd">const</span> <span class="nx">addTwo</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">value</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
</code></pre></div></div><p>Another function that multiplies a value by 3.</p><div class="language-js highlighter-rouge"><div class=highlight><pre class=highlight><code><span class="kd">const</span> <span class="nx">timesThree</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">value</span> <span class="o">*</span> <span class="mi">3</span><span class="p">;</span>
</code></pre></div></div><p>Putting the functions to use, we can write something like</p><div class="language-js highlighter-rouge"><div class=highlight><pre class=highlight><code><span class="kd">const</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">y</span> <span class="o">=</span> <span class="nf">addTwo</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">z</span> <span class="o">=</span> <span class="nf">timesThree</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span>
</code></pre></div></div><p>When run, it yields 9.</p><p>Another way to write this without the intermediate variables</p><div class="language-js highlighter-rouge"><div class=highlight><pre class=highlight><code><span class="kd">const</span> <span class="nx">x</span> <span class="o">=</span> <span class="nf">timesThree</span><span class="p">(</span><span class="nf">addTwo</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
</code></pre></div></div><p>Again yields 9, but is slightly awkward to read at a glance.</p><p><em>This is an example of Javascripts first class functions. We can use them as variables, and use them as values in other functions.</em></p><p>It works the same as the more verbose way, read from right to left. Starting with the value <code class="language-plaintext highlighter-rouge">1</code>, then passing that as an argument to <code class="language-plaintext highlighter-rouge">addTwo</code>, once again passing that as a param, this time to <code class="language-plaintext highlighter-rouge">timesThree</code>.</p><p>We can use composition to help us make it easier to read (this is also called Currying or Piping). There is one caveat; the composed functions can only have an arrity of 1 (they can only take 1 argument). Luckily for our simple functions above, they take 1 argument, and return 1 value. Ideal candidates for composition.</p><div class="language-js highlighter-rouge"><div class=highlight><pre class=highlight><code><span class="kd">function</span> <span class="nf">compose</span><span class="p">(...</span><span class="nx">fns</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span> <span class="nf">compose</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">fns</span><span class="p">.</span><span class="nf">reduce</span><span class="p">((</span><span class="nx">v</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">v</span><span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="nx">fn</span><span class="p">),</span> <span class="nb">Promise</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="nx">input</span><span class="p">));</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div><p>This compose function, takes a list of functions as arguments, and returns a new instance of the function that takes an argument which the original list of functions are applied in order.</p><p><strong>bonus, this handles promises returned from functions</strong></p><p>This is a slightly different approach from some userland libraries that offer composition/currying. They are usually read right to left because of how we pass in the first argument.</p><div class="language-js highlighter-rouge"><div class=highlight><pre class=highlight><code><span class="nf">compose</span><span class="p">(</span><span class="nx">addTwo</span><span class="p">,</span> <span class="nx">timesThree</span><span class="p">)(</span><span class="mi">1</span><span class="p">);</span>
</code></pre></div></div><p>This looks pretty good. A quick glance gets the majority of how it works, but the <code class="language-plaintext highlighter-rouge">1</code> seems out of place. With only a handful of operations it’s not a problem. It starts to break down when you have many operations that are being done.</p><div class="language-js highlighter-rouge"><div class=highlight><pre class=highlight><code><span class="kd">const</span> <span class="nx">life</span> <span class="o">=</span> <span class="nf">compose</span><span class="p">(</span>
  <span class="nx">drinkCoffee</span><span class="p">,</span>
  <span class="nx">eatBiscuit</span><span class="p">,</span>
  <span class="nx">playVideogame</span><span class="p">,</span>
  <span class="nx">sleep</span><span class="p">,</span>
  <span class="nx">drinkCoffee</span><span class="p">,</span>
  <span class="nx">gotoWork</span>
<span class="p">)(</span><span class="dl">"</span><span class="s2">greg</span><span class="dl">"</span><span class="p">);</span>
</code></pre></div></div><p>Reading the variable, then understanding that a composition is about to occurr, jump to the end, figure out what the argument is, jump back to the compose and read what is about to happen. Again, this is where having it read right to left might be preferable.</p><p>A very simple and quick fix for this is to define the initial value as the first argument in the list of functions. We’ll call this <code class="language-plaintext highlighter-rouge">pipe</code></p><div class="language-js highlighter-rouge"><div class=highlight><pre class=highlight><code><span class="kd">function</span> <span class="nf">pipe</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="p">...</span><span class="nx">fns</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nf">compose</span><span class="p">(...</span><span class="nx">fns</span><span class="p">)(</span><span class="nx">x</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div><p>Now we can move the initial value to the start of the list of arguments.</p><div class="language-js highlighter-rouge"><div class=highlight><pre class=highlight><code><span class="kd">const</span> <span class="nx">life</span> <span class="o">=</span> <span class="nf">compose</span><span class="p">(</span>
  <span class="dl">"</span><span class="s2">greg</span><span class="dl">"</span><span class="p">,</span>
  <span class="nx">drinkCoffee</span><span class="p">,</span>
  <span class="nx">eatBiscuit</span><span class="p">,</span>
  <span class="nx">playVideogame</span><span class="p">,</span>
  <span class="nx">sleep</span><span class="p">,</span>
  <span class="nx">drinkCoffee</span><span class="p">,</span>
  <span class="nx">gotoWork</span>
<span class="p">);</span>
</code></pre></div></div><p>That’s it. A brief look at function composition.</p><p>There’s still the issue of having each function take a single argument. The quick solution is Objects/Enums as the input/output of each function. Typechecking tools help here in figuring out what the IO for each step is.</p><p>Another solution, which I tend to reach for is to embrace the single argument functions, but make each function in the list, also return a function. That was worded horribly, here’s an example.</p><div class="language-js highlighter-rouge"><div class=highlight><pre class=highlight><code><span class="kd">const</span> <span class="nx">add</span> <span class="o">=</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">value</span> <span class="o">+</span> <span class="nx">i</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">multiply</span> <span class="o">=</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">value</span> <span class="o">*</span> <span class="nx">i</span><span class="p">;</span>

<span class="nf">pipe</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nf">add</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="nf">multiply</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
</code></pre></div></div><p>This yields 9 again, and gives the functions more flexibility/configurability without too much extra work.</p><p>This method is not ideal, but can help keep things simple when getting into function composition.</p><p>Here’s a real world example of function composition, that is not one of these trivial <code class="language-plaintext highlighter-rouge">(1 + 2) * 3 = 9</code> operations that is easier written inline.</p><div class="language-js highlighter-rouge"><div class=highlight><pre class=highlight><code><span class="k">async</span> <span class="kd">function</span> <span class="nf">createArticle</span><span class="p">(</span><span class="nx">article</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nf">connect</span><span class="p">()</span>

  <span class="k">return</span> <span class="k">await</span> <span class="nf">pipe</span><span class="p">(</span>
    <span class="nx">connection</span><span class="p">,</span>
    <span class="nf">useDatabase</span><span class="p">(</span><span class="nx">databaseName</span><span class="p">)</span>
    <span class="nf">useCollection</span><span class="p">(</span><span class="nx">collectionName</span><span class="p">)</span>
    <span class="nf">insertOne</span><span class="p">(</span><span class="nx">article</span><span class="p">)</span>
    <span class="nf">handleCreateResult</span><span class="p">()</span>
    <span class="nf">close</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div><p>Here you can read the composition top to bottom, with care in naming you don’t have to be a programmer to understand what’s going on.</p><p>Once you learn and determine how you can apply composition to your code, you’ll start to see the possibility of pipes everywhere and how they can simplify even the most complex functions into simple, legible operations.</p><p>Some guidlines to leave you with:</p><ul><li>Function should aim for an arrity of 1 to prevent complications</li><li>Function should do 1 thing, break multiple things into multiple functions</li><li>Composable functions lend themselves to unit tests</li></ul><p><strong>Some libraries that offer Composition</strong></p><ul><li><a href="//ramdajs.com/">Ramda</a></li><li><a href="//lodash.com/">Lodash</a></li></ul></article></main><aside><h2>Projects</h2><nav><ul><li><a href="/project/2023/12/28/fellow-stagg-repair.html"> Fellow Stagg Repair</a></li><li><a href="/project/2023/12/04/hyde-page-css-js.html"> Hyde Page CSS & JS</a></li><li><a href="/project/2023/12/03/hyde-fonts.html"> Hyde Fonts</a></li><li><a href="/project/2018/04/07/project-hyde.html"> Project Hyde</a></li></ul></nav><a href="/projects">More Projects</a><h2>Notes</h2><nav><ul><li><a href="/note/2024/07/30/callable-class-instance.html"> Callable Class Instance</a></li><li><a href="/note/2024/07/29/web-components.html"> Web Components</a></li><li><a href="/note/2024/02/10/hexdump-shell-command.html"> Hexdump shell command</a></li><li><a href="/note/2023/12/08/fixing-homebrew-permissions.html"> Fixing Hombrew permissions when using ASDF</a></li><li><a href="/note/2021/09/18/node-binary-artifacts.html"> Node CLI / Binary Artifacts</a></li></ul></nav><a href="/notebook">More Notes</a></aside></div><footer><p>©2024 Gregory Daynes</p><nav><ul><li><a href="mailto:email@gregdaynes.com">Contact</a></li><li><a href="/privacy.txt">Privacy</a></li><li><a href="/humans.txt">Humans</a></li><li><a href="/robots.txt">Robots</a></li><li><a href="/sitemap.xml">Site Map</a></li><li><a href="/feed.xml">RSS</a></li></ul></nav><p><small>Content on this site is licensed under Creative Common Attribution-ShareAlike 4.0 International License. All code content is licensed under the MIT license, unless an excerpt from a larger work under another license.</small></p></footer></body></html>