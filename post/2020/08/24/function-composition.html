<!DOCTYPE html> <!-- Greg Daynes by Gregory Daynes URL: https://gregdaynes.com --> <html lang="en-GB"> <head> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Function Composition | Greg Daynes</title> <meta name="generator" content="Jekyll v4.3.3" /> <meta property="og:title" content="Function Composition" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Use function composition to construct functions greater than the sum of their parts." /> <meta property="og:description" content="Use function composition to construct functions greater than the sum of their parts." /> <link rel="canonical" href="https://gregdaynes.com/post/2020/08/24/function-composition.html" /> <meta property="og:url" content="https://gregdaynes.com/post/2020/08/24/function-composition.html" /> <meta property="og:site_name" content="Greg Daynes" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2020-08-24T00:00:00+00:00" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Function Composition" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2020-08-24T00:00:00+00:00","datePublished":"2020-08-24T00:00:00+00:00","description":"Use function composition to construct functions greater than the sum of their parts.","headline":"Function Composition","mainEntityOfPage":{"@type":"WebPage","@id":"https://gregdaynes.com/post/2020/08/24/function-composition.html"},"url":"https://gregdaynes.com/post/2020/08/24/function-composition.html"}</script> <!-- End Jekyll SEO tag --> <meta name="viewport" content="width=device-width, initial-scale=1"> <meta name="page-datetime" content=""> <meta name="author" content="/humans.txt"> <meta name="keywords" content=""> <meta name="no-email-collection" content="/privacy.txt"> <meta name="description" content="The website and home of Gregory Daynes. Find links to projects, notebooks, and resume."> <meta name='HandheldFriendly' content='True'> <meta name='MobileOptimized' content='375'> <title>Function Composition &bull; Greg Daynes</title> <link href='/assets/fonts/fonts.css' rel='stylesheet'> <link rel="stylesheet" href="/assets/css/variables-reset-utils-base-header-footer-toc-list-be9ec6.css?"> <link rel="stylesheet" href="/assets/css/card-26e86d.css?"> <link rel="stylesheet" href="/assets/css/post-4d935c.css?"> <link rel="author" href="/humans.txt" /> <link rel="me" href="https://mastodon.social/@gregdaynes" /> <link type="application/atom+xml" rel="alternate" href="https://gregdaynes.com/feed.xml" title="Greg Daynes" /> <link rel="shortcut icon" href="/assets/img/favicon-32x32.png" /> <body class="page function-composition"> <header> <hgroup> <h1><a href="/">Greg Daynes</a></h1> <h2>Full Stack Software Design, Development & Management</h2> </hgroup> <nav class="center"> <a href="/">Home</a> <a href="/about">About</a> <a href="/resume">Resume</a> <a href="/projects">Projects</a> <a href="/notebook">Notebook</a> </nav> </header> <div class="main-wrapper"> <main> <article> <h2>Function Composition <hr></h2> <p>This is a quick look at applying one of the core concepts in functional programming - Composition.</p> <p>Starting with a simple function that takes a number as value and adds 2.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">addTwo</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">value</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
</code></pre></div></div> <p>Another function that multiplies a value by 3.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">timesThree</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">value</span> <span class="o">*</span> <span class="mi">3</span><span class="p">;</span>
</code></pre></div></div> <p>Putting the functions to use, we can write something like</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">y</span> <span class="o">=</span> <span class="nf">addTwo</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">z</span> <span class="o">=</span> <span class="nf">timesThree</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span>
</code></pre></div></div> <p>When run, it yields 9.</p> <p>Another way to write this without the intermediate variables</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">x</span> <span class="o">=</span> <span class="nf">timesThree</span><span class="p">(</span><span class="nf">addTwo</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
</code></pre></div></div> <p>Again yields 9, but is slightly awkward to read at a glance.</p> <p><em>This is an example of Javascripts first class functions. We can use them as variables, and use them as values in other functions.</em></p> <p>It works the same as the more verbose way, read from right to left. Starting with the value <code class="language-plaintext highlighter-rouge">1</code>, then passing that as an argument to <code class="language-plaintext highlighter-rouge">addTwo</code>, once again passing that as a param, this time to <code class="language-plaintext highlighter-rouge">timesThree</code>.</p> <p>We can use composition to help us make it easier to read (this is also called Currying or Piping). There is one caveat; the composed functions can only have an arrity of 1 (they can only take 1 argument). Luckily for our simple functions above, they take 1 argument, and return 1 value. Ideal candidates for composition.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">compose</span><span class="p">(...</span><span class="nx">fns</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span> <span class="nf">compose</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">fns</span><span class="p">.</span><span class="nf">reduce</span><span class="p">((</span><span class="nx">v</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">v</span><span class="p">.</span><span class="nf">then</span><span class="p">(</span><span class="nx">fn</span><span class="p">),</span> <span class="nb">Promise</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="nx">input</span><span class="p">));</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div> <p>This compose function, takes a list of functions as arguments, and returns a new instance of the function that takes an argument which the original list of functions are applied in order.</p> <p><strong>bonus, this handles promises returned from functions</strong></p> <p>This is a slightly different approach from some userland libraries that offer composition/currying. They are usually read right to left because of how we pass in the first argument.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">compose</span><span class="p">(</span><span class="nx">addTwo</span><span class="p">,</span> <span class="nx">timesThree</span><span class="p">)(</span><span class="mi">1</span><span class="p">);</span>
</code></pre></div></div> <p>This looks pretty good. A quick glance gets the majority of how it works, but the <code class="language-plaintext highlighter-rouge">1</code> seems out of place. With only a handful of operations it’s not a problem. It starts to break down when you have many operations that are being done.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">life</span> <span class="o">=</span> <span class="nf">compose</span><span class="p">(</span>
  <span class="nx">drinkCoffee</span><span class="p">,</span>
  <span class="nx">eatBiscuit</span><span class="p">,</span>
  <span class="nx">playVideogame</span><span class="p">,</span>
  <span class="nx">sleep</span><span class="p">,</span>
  <span class="nx">drinkCoffee</span><span class="p">,</span>
  <span class="nx">gotoWork</span>
<span class="p">)(</span><span class="dl">"</span><span class="s2">greg</span><span class="dl">"</span><span class="p">);</span>
</code></pre></div></div> <p>Reading the variable, then understanding that a composition is about to occurr, jump to the end, figure out what the argument is, jump back to the compose and read what is about to happen. Again, this is where having it read right to left might be preferable.</p> <p>A very simple and quick fix for this is to define the initial value as the first argument in the list of functions. We’ll call this <code class="language-plaintext highlighter-rouge">pipe</code></p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">pipe</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="p">...</span><span class="nx">fns</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nf">compose</span><span class="p">(...</span><span class="nx">fns</span><span class="p">)(</span><span class="nx">x</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <p>Now we can move the initial value to the start of the list of arguments.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">life</span> <span class="o">=</span> <span class="nf">compose</span><span class="p">(</span>
  <span class="dl">"</span><span class="s2">greg</span><span class="dl">"</span><span class="p">,</span>
  <span class="nx">drinkCoffee</span><span class="p">,</span>
  <span class="nx">eatBiscuit</span><span class="p">,</span>
  <span class="nx">playVideogame</span><span class="p">,</span>
  <span class="nx">sleep</span><span class="p">,</span>
  <span class="nx">drinkCoffee</span><span class="p">,</span>
  <span class="nx">gotoWork</span>
<span class="p">);</span>
</code></pre></div></div> <p>That’s it. A brief look at function composition.</p> <p>There’s still the issue of having each function take a single argument. The quick solution is Objects/Enums as the input/output of each function. Typechecking tools help here in figuring out what the IO for each step is.</p> <p>Another solution, which I tend to reach for is to embrace the single argument functions, but make each function in the list, also return a function. That was worded horribly, here’s an example.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">add</span> <span class="o">=</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">value</span> <span class="o">+</span> <span class="nx">i</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">multiply</span> <span class="o">=</span> <span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nx">value</span> <span class="o">*</span> <span class="nx">i</span><span class="p">;</span>

<span class="nf">pipe</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nf">add</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="nf">multiply</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
</code></pre></div></div> <p>This yields 9 again, and gives the functions more flexibility/configurability without too much extra work.</p> <p>This method is not ideal, but can help keep things simple when getting into function composition.</p> <p>Here’s a real world example of function composition, that is not one of these trivial <code class="language-plaintext highlighter-rouge">(1 + 2) * 3 = 9</code> operations that is easier written inline.</p> <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">async</span> <span class="kd">function</span> <span class="nf">createArticle</span><span class="p">(</span><span class="nx">article</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">connection</span> <span class="o">=</span> <span class="nf">connect</span><span class="p">()</span>

  <span class="k">return</span> <span class="k">await</span> <span class="nf">pipe</span><span class="p">(</span>
    <span class="nx">connection</span><span class="p">,</span>
    <span class="nf">useDatabase</span><span class="p">(</span><span class="nx">databaseName</span><span class="p">)</span>
    <span class="nf">useCollection</span><span class="p">(</span><span class="nx">collectionName</span><span class="p">)</span>
    <span class="nf">insertOne</span><span class="p">(</span><span class="nx">article</span><span class="p">)</span>
    <span class="nf">handleCreateResult</span><span class="p">()</span>
    <span class="nf">close</span><span class="p">(</span><span class="nx">connection</span><span class="p">)</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <p>Here you can read the composition top to bottom, with care in naming you don’t have to be a programmer to understand what’s going on.</p> <p>Once you learn and determine how you can apply composition to your code, you’ll start to see the possibility of pipes everywhere and how they can simplify even the most complex functions into simple, legible operations.</p> <p>Some guidlines to leave you with:</p> <ul> <li>Function should aim for an arrity of 1 to prevent complications</li> <li>Function should do 1 thing, break multiple things into multiple functions</li> <li>Composable functions lend themselves to unit tests</li> </ul> <p><strong>Some libraries that offer Composition</strong></p> <ul> <li><a href="https://ramdajs.com/">Ramda</a></li> <li><a href="https://lodash.com/">Lodash</a></li> </ul> </article> </main> <aside> <section> <h2>Projects <hr></h2> <div class="card-deck"> <a class="card" href="/project/2023/12/28/fellow-stagg-repair.html">Fellow Stagg Repair</a> <a class="card" href="/project/2023/11/11/turing-pi.html">Turing Pi</a> <a class="card" href="/project/2023/12/04/hyde-page-css-js.html">Hyde Page CSS & JS</a> <a class="card" href="/project/2023/12/03/hyde-fonts.html">Hyde Fonts</a> </div> <span><a class="more" href="/projects">More Projects</a></span> </section> <section> <h2>Notes <hr></h2> <ol class="toc-list"> <li> <span class="row"> <span class="title"> <a href="/note/2023/12/08/fixing-homebrew-permissions.html">Fixing Hombrew permissions when using ASDF</a> </span> </span> </li> <li> <span class="row"> <span class="title"> <a href="/note/2021/09/18/node-binary-artifacts.html">Node CLI / Binary Artifacts</a> </span> </span> </li> </ol> <span><a class="more" href="/notebook">More Notes</a></span> </section> </aside> </div> <footer> <div>©2024 Gregory Daynes</div> <nav> <a href="mailto:email@gregdaynes.com">Contact</a> <a href="/privacy.txt">Privacy</a> <a href="/humans.txt">Humans</a> <a href="/robots.txt">Robots</a> <a href="/sitemap.xml">Site Map</a> <a href="/feed.xml">RSS</a> </nav> <p><small>Content on this site is licensed under Creative Common Attribution-ShareAlike 4.0 International License. All code content is licensed under the MIT license, unless an excerpt from a larger work under another license.</small></p> </footer> <script src="/assets/js/fittext-header-365689.js"></script> </body> </html>
